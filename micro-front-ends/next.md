# Next

Analizador de codigo estatico: pude verificar bunas o malas practica del codigo, como Linter



PARA instalar la dependencia **`npm install next-auth`**



PAra ejecutar, con next.js ya no ocupamos una carpeta source, y se utiliza el comando

```
npm create-next-app deploy-app
```

Te va a preguntar:&#x20;

Would you like to use TypeScript? **No** / Yes&#x20;

Would you like to use ESLint? No / **Yes**&#x20;

Se utiliza mucho SonarQube para el analisis de nuestro codigo, uno de ellos es la cicloticidad ? ciclos

Would you like to use TailWind CSS? **No** / Yes&#x20;

No es necesario dado que

aWould you like to use src/  directory? **No** / Yes&#x20;

Dado que ya se crean y sabe usar los directorios no es necesario, en nuestro caso si usamos una direccion del tipo: localhost:3000/home, donde en home -> page.jsx ya lo identifica como directorio

aWould you like to use App Router? No / **Yes**&#x20;

A partir de la version 13, en lugar que hagas el ruteo a través de código se realiza por medio de los directorios.

Would you like to use customize the default? **No** / Yes&#x20;

Aquí empieza a instalar las dependencias



En lugar de usar `npm start` usaremos `npm run dev`&#x20;

La pantalla de inicio esta en api -> page.js

Archivo Layout contiene la función principal.&#x20;

Children, significa que todo lo que coloquemos en page.js se va a pasar a nuestro layout, en lugar de tener root.render (App) se pasa el children.



Autenticación NextAuth solo trabaja con aplicaciones generadas con next.js&#x20;



Modificaciones de la conexión con Google.



La primer url será http://localhost:3000

Segunda url de redirreccionamiento autorizado se usa: http://localhost:3000/api/auth/callback/google







Codigo



{% code title="page.jsx " overflow="wrap" lineNumbers="true" %}
```javascript
import UserInfo from '@/components/user-info';
import { Grid } from '@mui/material';

export default function Home() {
  return (
    <Grid 
      container
      justifyContent='center'
      alignItems='center'
      style={{ height: '100vh', marginTop: '-24px' }}
    >
      <UserInfo />
    </Grid>
  );
}
```
{% endcode %}



{% code title="navbar.jsx" overflow="wrap" lineNumbers="true" %}
```javascript
'use client';

import { AppBar, Box, Button, Toolbar, Typography } from '@mui/material';
import { useSession, signIn, signOut } from 'next-auth/react';

export default function Navbar() {
    const { status } = useSession();
    return (
        <Box sx={{ flexGrow: 1 }}>
            <AppBar position='static' sx={{ boxShadow: 'md' }}>
                <Toolbar>
                    <Typography variant='h6' component='div' sx={{ flexGrow: 1 }}>
                        App
                    </Typography>
                    {status === 'authenticated' ? (
                        <Button onClick={() => signOut()} color='inherit'>Sign Out</Button>
                    ) : (
                        <Button onClick={() => signIn('google')} color='inherit'>Sign In</Button>
                    )}
                </Toolbar>
            </AppBar>
        </Box>
    );
}
```
{% endcode %}

**'use-client';** - te ayuda a saber que tipo de aplicación se esta creando:&#x20;

**useSession** - obtiene los datos obtenidos por Google, datos de usuario, token, en base al status se podrá saber si estamos o no autenticados.

si esta autenticado    `{status === 'authenticated' ? (`  mostrar botón SignOut, sino `) : (` mostrar botón SignIn `)`&#x20;

<mark style="color:red;">Si se usa otro proveedor, en lugar de google se colocará el que se usara</mark>



Colocamos nuestros componentes:

{% code title="layout.js" overflow="wrap" lineNumbers="true" %}
```javascript
import Navbar from '@/components/navbar'
import { Inter } from 'next/font/google'
import { NextAuthProvider } from './Providers'

const inter = Inter({ subsets: ['latin'] })

export const metadata = {
  title: 'Create Next App',
  description: 'Generated by create next app',
}

export default function RootLayout({ children }) {
  return (
    <html lang="en">
      <body suppressHydrationWarning={true} className={inter.className}>
        <NextAuthProvider>
          <Navbar />
          {children}
        </NextAuthProvider>
      </body>
    </html>
  )
}


```
{% endcode %}

Componente de botón Sign in with google

{% code title="navbar.jsx" overflow="wrap" lineNumbers="true" %}
```javascript
'use client';

import { Button, Typography } from '@mui/material';
import GoogleIcon from '@mui/icons-material/Google';
import { signIn } from 'next-auth/react';

export default function SignInBtn() {
  return (
    <Button
      onClick={() => signIn('google')}
      variant='contained'
      color='primary'
      sx={{
        borderRadius: '24px',
        padding: '8px 16px',
        boxShadow: '0px 2px 4px rgba(0, 0, 0, 0.2)',
        '&:hover': {
          backgroundColor: '#2E7D32',
        },
      }}
    >
      <GoogleIcon sx={{ fontSize: 30, marginRight: 1 }} />
      <Typography variant="button" sx={{ color: 'white' }}>
        Sign in with Google
      </Typography>
    </Button>
  );
}
```
{% endcode %}



{% code title="signin-btn.jsx" overflow="wrap" lineNumbers="true" %}
```javascript
'use client';

import SignInBtn from './signin-btn';
import { useSession } from 'next-auth/react';
import { Avatar, Grid, Paper, Typography } from '@mui/material';

export default function UserInfo() {
    const { status, data: session } = useSession();

    if (status === 'authenticated') {
        return (
            <Grid container justifyContent='center'>
                <Paper elevation={8}  sx={{ p: 3, borderRadius: 3, bgcolor: '#FFE082' }} >
                    <Avatar src={session?.user?.image} sx={{ width: 60, height: 60, bgcolor: 'white' }} />
                    <Typography variant='h5' sx={{ mt: 2 }}>
                        Name: <Typography variant='subtitle1' component='span' sx={{ fontWeight: 'bold' }}>{session?.user.name}</Typography>
                    </Typography>
                    <Typography variant='h5' sx={{ mt: 2 }}>
                        Email: <Typography variant='subtitle1' component='span' sx={{ fontWeight: 'bold' }}>{session?.user.email}</Typography>
                    </Typography>
                </Paper>
            </Grid>
        );
    } else {
        return <SignInBtn />;
    }
}
```
{% endcode %}

**data: session** - datos de la sesión, avatar, token, datos del usuario.

PAra obtener estos datos se usa: **`{session?.user.`**`name`**`}` **  &#x20;

se debe configurarel dominio de las imagenes de la sesión en la configuracion de next.js la cual es:&#x20;

{% code title="next.config.js" overflow="wrap" lineNumbers="true" %}
```javascript
/** @type {import('next').NextConfig} */
const nextConfig = {
    images: {
        domains: ['lh3.googleusercontent.com']
    }
}

module.exports = nextConfig
```
{% endcode %}

Crear las carpetas de la siguiente manera:&#x20;

&#x20;app -> api -> auth -> {...nextauth}

Ojo con el ultimo nombre de la carpeta.



route.js se genera tal cual

```javascript
import NextAuth from 'next-auth/next';
import GoogleProvider from 'next-auth/providers/google'

const authOptions = {
    providers: [
        GoogleProvider({
            clientId: process.env.GOOGLE_CLIENT_ID,
            clientSecret: process.env.GOOGLE_CLIENT_SECRET,
        }),
    ],
};

const handler = NextAuth(authOptions);
export { handler as GET, handler as POST };
```

Estos datos que obteniamos los colocamos como variables de entorno.  Dentro de la raiz del proyecto se creo un .env, esto no se sube por lo que se puede colocar en el gitignore al repositorio.&#x20;

{% code title=".env" overflow="wrap" lineNumbers="true" %}
```
#aqui van lo datos sensibles usando variables de entorno.

 GOOGLE_CLIENT_ID=
 GOOGLE_CLIENT_SECRET=
 NEXTAUTH_URL=
 NEXTAUTH_SECRET=
```
{% endcode %}



Petición GET se da en la URL plana, por ejemplo con localhost:3000/username<=admin se ve de manera plana y una petición POST cambia y enmascara localhost:3000/saezdSaT4r&#x20;



Creamos el archivo Providers.&#x20;

{% code title="providers.js" overflow="wrap" lineNumbers="true" %}
```javascript
'use client';

import { SessionProvider } from 'next-auth/react';

export const NextAuthProvider = ({children}) => {
    return <SessionProvider>{children}</SessionProvider>
};
```
{% endcode %}

Session Provider: en este archivo se le indica que va a mantener esa autenticación.&#x20;



Para la autenticación se puede revisar a partir de la documentación de next.js:

{% embed url="https://next-auth.js.org/providers/" %}











